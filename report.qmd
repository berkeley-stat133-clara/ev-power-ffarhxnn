---
title: "EV Power - Lab 4 Project Report"
format: typst
---

# Example Solution 1

## **Part 0: libraries**

```{r}
library(tidyverse)
library(janitor)
library(stringr)
library(ggplot2)

```

## **Part 1:** **Defining Research Question**

Chosen Question: //In 2023, do states with a higher share of renewable energy also have more EVS registered?
## **Part 2: Data Preparation and Cleaning**

```{r}
normalize_state <- function(x) {
  x <- str_squish(str_to_title(x))
  x <- ifelse(x %in% c("District Of Columbia","Washington Dc","D.C.","Dc"),
              "District Of Columbia", x)
  abbs <- tibble(name = state.name, abb = state.abb) |>
    bind_rows(tibble(name = "District Of Columbia", abb = "DC"))
  is_abb <- str_detect(x, "^[A-Z]{2}$")
  x[is_abb] <- abbs$name[match(x[is_abb], abbs$abb)]
  str_to_lower(x)
renew_23 <- read_csv("renew_use_2023.csv", show_col_types = FALSE) |>
  clean_names() |>
  rename_with(~ str_replace_all(.x, c("renew.*"="renewable_energy"))) |>
  mutate(state = normalize_state(state),
         year = 2023)

total_23 <- read_csv("total_energy_use_2023.csv", show_col_types = FALSE) |>
  clean_names() |>
  rename_with(~ str_replace_all(.x, c("total.*"="total_energy"))) |>
  mutate(state = normalize_state(state),
         year = 2023)

ev_23 <- read_csv("ev-registrations-by_state_2023.csv", show_col_types = FALSE) |>
  clean_names() |>
  rename_with(~ str_replace_all(.x, c("ev.*"="ev_registrations"))) |>
  mutate(state = normalize_state(state),
         year = 2023)

```

## **Part 3: Joining / Pivoting Datasets for Analysis**

```{r}
dat_23 <- total_23 |>
  left_join(renew_23, by = c("state","year")) |>
  left_join(ev_23, by = c("state","year")) |>
  mutate(
    renewable_share = renewable_energy / total_energy,
    renewable_share_pct = 100 * renewable_share
```

## **Part 4: Mapping Visualization**

```{r}
us_map <- map_data("state") |> as_tibble() |> rename(state = region)

ggplot(df_2023 |> left_join(us_map, by = "state"),
       aes(long, lat, group = group, fill = renewable_share_pct)) +
  geom_polygon(color = "white", linewidth = 0.2) +
  coord_quickmap() +
  scale_fill_viridis_c(name = "Renewables (%)", option = "C") +
  labs(title = "Renewable Energy Share by State (2023)",
       subtitle = "Higher values indicate a cleaner electricity mix",
       caption = "Source: Project 4 datasets (2021â€“2023)") +
  theme_void() +
  theme(legend.position = "right",
        plot.title = element_text(face = "bold"))
```